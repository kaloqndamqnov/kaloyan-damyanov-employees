uuid: c448eeae-e27d-4b88-9541-a5ed08c3f90a
langcode: en
status: true
dependencies:
  config:
    - field.storage.node.field_date_from
    - field.storage.node.field_date_to
    - field.storage.node.field_employee
    - field.storage.node.field_project
    - node.type.project_assignment
  module:
    - datetime
    - node
id: employees_worked_together
label: 'Employees Worked Together'
module: views
description: 'Shows pairs of employees who worked together on the same project, with overlapping days.'
tag: ''
base_table: node_field_data
base_field: nid
display:
  default:
    id: default
    display_title: Master
    display_plugin: default
    position: 0
    display_options:
      title: 'Employees Worked Together'
      fields:
        employee_a:
          id: field_employee
          table: node__field_employee
          field: field_employee
          relationship: none
          plugin_id: field
          label: 'Employee ID 1'
          exclude: false
          type: entity_reference_entity_id
          settings: {  }
        employee_b_id:
          id: field_employee
          table: node__field_employee
          field: field_employee
          relationship: employee_b
          plugin_id: field
          label: 'Employee ID 2'
          exclude: false
          type: entity_reference_entity_id
          settings: {  }
        project_id:
          id: field_project
          table: node__field_project
          field: field_project
          relationship: none
          plugin_id: field
          label: 'Project ID'
          exclude: false
          type: entity_reference_entity_id
          settings: {  }
        date_from_a:
          id: field_date_from
          table: node__field_date_from
          field: field_date_from
          relationship: none
          plugin_id: field
          label: date_from_A
          exclude: true
        date_to_a:
          id: field_date_to
          table: node__field_date_to
          field: field_date_to
          relationship: none
          plugin_id: field
          label: date_to_A
          exclude: true
        date_from_b:
          id: field_date_from
          table: node__field_date_from
          field: field_date_from
          relationship: assignments_b
          plugin_id: field
          label: date_from_B
          exclude: true
        date_to_b:
          id: field_date_to
          table: node__field_date_to
          field: field_date_to
          relationship: assignments_b
          plugin_id: field
          label: date_to_B
          exclude: true
        days_worked:
          id: nothing
          table: views
          field: nothing
          plugin_id: views_nothing
          label: 'Days worked'
          exclude: false
          alter:
            alter_text: true
            text: |
              {% set from1 = date(date_from_A) %}
              {% set to1 = date(date_to_A ?: 'now') %}
              {% set from2 = date(date_from_B) %}
              {% set to2 = date(date_to_B ?: 'now') %}

              {% set start = from1 > from2 ? from1 : from2 %}
              {% set end = to1 < to2 ? to1 : to2 %}

              {% if start <= end %}
                {{ ((end|date('U') - start|date('U')) / 86400)|round(0,'floor') }}
              {% else %}
                0
              {% endif %}
      filters:
        type:
          id: type
          table: node_field_data
          field: type
          plugin_id: bundle
          operator: in
          value:
            project_assignment: project_assignment
      style:
        type: table
      query:
        type: views_query
        options:
          disable_sql_rewrite: true
      relationships:
        project_of_a:
          id: field_project
          table: node__field_project
          field: field_project
          relationship: none
          admin_label: 'Project of A'
          plugin_id: standard
          required: true
        assignments_b:
          id: field_project_1
          table: node__field_project
          field: field_project
          relationship: project_of_a
          admin_label: 'Assignments B'
          plugin_id: standard
          required: true
        employee_b:
          id: field_employee_1
          table: node__field_employee
          field: field_employee
          relationship: assignments_b
          admin_label: 'Employee B'
          plugin_id: standard
          required: true
      display_extenders: {  }
    cache_metadata:
      max-age: -1
      contexts:
        - 'languages:language_content'
        - 'languages:language_interface'
        - url.query_args
        - 'user.node_grants:view'
      tags:
        - 'config:field.storage.node.field_date_from'
        - 'config:field.storage.node.field_date_to'
        - 'config:field.storage.node.field_employee'
        - 'config:field.storage.node.field_project'
  page:
    id: page
    display_title: Page
    display_plugin: page
    position: 1
    display_options:
      display_extenders: {  }
      path: employees-worked-together
    cache_metadata:
      max-age: -1
      contexts:
        - 'languages:language_content'
        - 'languages:language_interface'
        - url.query_args
        - 'user.node_grants:view'
      tags:
        - 'config:field.storage.node.field_date_from'
        - 'config:field.storage.node.field_date_to'
        - 'config:field.storage.node.field_employee'
        - 'config:field.storage.node.field_project'
